<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>Working with real data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="03_introduction_data_manipulation_files/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    background-color: #ffffff;
    color: #a0a0a0;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
div.sourceCode
  { color: #1f1c1b; background-color: #ffffff; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span. { color: #1f1c1b; } /* Normal */
code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
code span.an { color: #ca60ca; } /* Annotation */
code span.at { color: #0057ae; } /* Attribute */
code span.bn { color: #b08000; } /* BaseN */
code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
code span.ch { color: #924c9d; } /* Char */
code span.cn { color: #aa5500; } /* Constant */
code span.co { color: #898887; } /* Comment */
code span.cv { color: #0095ff; } /* CommentVar */
code span.do { color: #607880; } /* Documentation */
code span.dt { color: #0057ae; } /* DataType */
code span.dv { color: #b08000; } /* DecVal */
code span.er { color: #bf0303; text-decoration: underline; } /* Error */
code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
code span.fl { color: #b08000; } /* Float */
code span.fu { color: #644a9b; } /* Function */
code span.im { color: #ff5500; } /* Import */
code span.in { color: #b08000; } /* Information */
code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
code span.op { color: #1f1c1b; } /* Operator */
code span.ot { color: #006e28; } /* Other */
code span.pp { color: #006e28; } /* Preprocessor */
code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
code span.sc { color: #3daee9; } /* SpecialChar */
code span.ss { color: #ff5500; } /* SpecialString */
code span.st { color: #bf0303; } /* String */
code span.va { color: #0057ae; } /* Variable */
code span.vs { color: #bf0303; } /* VerbatimString */
code span.wa { color: #bf0303; } /* Warning */
</style>

<link rel="stylesheet" href="03_introduction_data_manipulation_files/reveal.js-3.3.0.1/css/theme/moon.css" id="theme">

<style type="text/css">
.reveal section img {
  background: rgba(255, 255, 255, 0.85);
}
</style>

  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="styles.css"/>

<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">Working with real data</h1>
</section>

<section id="importing-your-data" class="slide level2">
<h2>Importing your data</h2>
<p>Until now we have been working with simple data generated within R.</p>
<p>However, most of the time we want to work with external data.</p>
<ul>
<li class="fragment">Various sources and types of data: text file, images (geotif/raster).</li>
<li class="fragment">Most of the time either <strong>.csv</strong> or <strong>.xls</strong> formats.</li>
</ul>
</section>
<section id="data-frames" class="slide level2">
<h2>Data frames</h2>
<p><strong>Data frames</strong> are important objects in R which are created when reading a file.</p>
<p>Can be seen as an Excel tabular sheet:</p>
<ul>
<li><strong>Lines are observations</strong></li>
<li><strong>Columns are variables</strong></li>
</ul>
<p>A data frame can be seen as a matrix with the difference that <strong>columns (variables) can be of different types</strong> (numerics, dates, characters, etc.).</p>
</section>
<section id="examples" class="slide level2">
<h2>Examples</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># See the first 6 rows of the mpg data frame (included in R)</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">head</span>(mtcars) </a></code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</section>
<section id="structure-of-a-df" class="slide level2">
<h2>Structure of a df</h2>
<p>After you opened a data file, it is always a good idea to look the structure of the returned data frame. This ensure that all variables have the right types.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">str</span>(mtcars) <span class="co"># str stands for structure</span></a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    32 obs. of  11 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...
##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num  16.5 17 18.6 19.4 17 ...
##  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...</code></pre>
</section>
<section id="useful-functions" class="slide level2">
<h2>Useful functions</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">names</span>(mtcars) <span class="co"># List column names</span></a></code></pre></div>
<pre><code>##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot; &quot;carb&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">nrow</span>(mtcars) <span class="co"># Return the number of row (observations)</span></a></code></pre></div>
<pre><code>## [1] 32</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">ncol</span>(mtcars) <span class="co"># Return the number of column (variables)</span></a></code></pre></div>
<pre><code>## [1] 11</code></pre>
</section>
<section id="accessing-elements-of-data-frame" class="slide level2">
<h2>Accessing elements of data frame</h2>
<p>There are two main ways to access data of a data frame.</p>
<h4 id="first-method">First method</h4>
<p>The first way to access elements of a data frame consists in using <strong>indexes</strong> as we did for accessing matrix.</p>
<p>For example,</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">mtcars[<span class="dv">1</span>, <span class="dv">3</span>]</a></code></pre></div>
<pre><code>## [1] 160</code></pre>
</section>
<section class="slide level2">

<p>Accessing columns of a data frame.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">mtcars[, <span class="dv">4</span>] <span class="co"># Column 4 (i.e &quot;hp&quot;)</span></a></code></pre></div>
<pre><code>##  [1] 110 110  93 110 175 105 245  62  95 123 123 180 180 180 205 215 230  66  52  65  97 150 150 245 175  66  91 113 264 175 335 109</code></pre>
</section>
<section class="slide level2">

<p>Accessing rows of a data frame.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">mtcars[<span class="dv">1</span>, ] <span class="co"># First row </span></a></code></pre></div>
<pre><code>##           mpg cyl disp  hp drat   wt  qsec vs am gear carb
## Mazda RX4  21   6  160 110  3.9 2.62 16.46  0  1    4    4</code></pre>
</section>
<section class="slide level2">

<h4 id="second-method">Second method</h4>
<p>The second method to access elements of a data frame consists in using the <code>$</code> operator using the <code>df$variable</code> scheme.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">mtcars<span class="op">$</span>cyl <span class="co"># Return the values of the vector named &quot;cyl&quot;</span></a></code></pre></div>
<pre><code>##  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4</code></pre>
</section>
<section class="slide level2">

<p>Using the second method makes things more obvious and easy to read since you don’t have to wonder the position (indexes) of the variables in the data frame.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">mtcars<span class="op">$</span>cyl[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>] <span class="co"># first 10 values of the vector names &quot;cyl&quot;</span></a></code></pre></div>
<pre><code>##  [1] 6 6 4 6 8 6 8 4 4 6</code></pre>
</section>
<section id="quick-rstudio-tip" class="slide level2">
<h2>Quick-RStudio tip</h2>
<blockquote>
<p>After typing the name of a data frame, the list of all variables within this data frame will appears. Use the keyboard to select the variable of interest.</p>
</blockquote>
</section>
<section id="csv-and-excel-files" class="slide level2">
<h2>CSV and Excel files</h2>
<p>I recommend to use <code>readr</code> and <code>readxl</code> libraries for reading CSV and Excel files. These two libraries are not installed by default.</p>
<center>
<img src="https://readr.tidyverse.org/logo.png" width="150"/> <img src="https://readxl.tidyverse.org/logo.png" width="150"/>
</center>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;readr&quot;</span>) <span class="co"># Package to read csv files</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="st">&quot;readxl&quot;</span>) <span class="co"># Package to read Excel files</span></a></code></pre></div>
</section>
<section class="slide level2">

<p>Reading Excel files</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">library</span>(readxl) <span class="co"># Load the readxl package</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">mydata &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;/path/to/myfile.xls&quot;</span>)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">mydata &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;/path/to/myfile.xlsx&quot;</span>, <span class="dt">sheet =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>Reading csv files</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">library</span>(readr) <span class="co"># Load the readr package</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">mydata &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;/path/to/myfile.csv&quot;</span>) <span class="co"># Read some data</span></a></code></pre></div>
<p>Use <code>read_csv2()</code> if you are using CSV files produced with EU settings (<code>;</code> instead of <code>,</code> separator).</p>
</section>
<section id="other-file-formats" class="slide level2">
<h2>Other file formats</h2>
<p>There are many file format supported by R. This is a list of functions to use to open most used file format.</p>
<table>
<thead>
<tr class="header">
<th><strong>Data format</strong></th>
<th><strong>Function</strong></th>
<th><strong>Package</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Comma separated values (.csv)</td>
<td>read_csv()</td>
<td>readr</td>
</tr>
<tr class="even">
<td>Excel (.xls, .xlsx)</td>
<td>read_excel()</td>
<td>readxl</td>
</tr>
<tr class="odd">
<td>Other text files (.txt, .dat, …)</td>
<td>read_delim()</td>
<td>readr</td>
</tr>
<tr class="even">
<td>Stata</td>
<td>read_stata()</td>
<td>haven</td>
</tr>
<tr class="odd">
<td>SPSS</td>
<td>read_spss()</td>
<td>haven</td>
</tr>
<tr class="even">
<td>SAS</td>
<td>read_sas()</td>
<td>haven</td>
</tr>
<tr class="odd">
<td>Matlab file (.mat)</td>
<td>readMat()</td>
<td>R.matlab</td>
</tr>
</tbody>
</table>
</section>
<section id="exercise" class="slide level2 exercises">
<h2>Exercise</h2>
<h4 id="exercise-1">Exercise #1</h4>
<p>Open and explore your data in R and start exploring them.</p>
<ul>
<li>Data types as expected?</li>
<li>How missing values (<code>NA</code>) have been handled by R?</li>
<li>Any problems?</li>
</ul>
</section>
<section id="data-manipulation" class="slide level2">
<h2>Data manipulation</h2>
<blockquote>
<p>It is often said that 80% of data analysis is spent on the cleaning and preparing data. And it’s not just a first step, but it must be repeated many over the course of analysis as new problems come to light or new data is collected.</p>
</blockquote>
<ul>
<li class="fragment">Two main characteristics of good data manipulation:
<ul>
<li class="fragment"><strong>speed</strong> (results are returned in reasonable time)</li>
<li class="fragment"><strong>elegance</strong> (easy to use and understand what is going on)</li>
</ul></li>
</ul>
</section>
<section id="the-tidyverse" class="slide level2">
<h2>The tidyverse</h2>
<blockquote>
<p>The tidyverse is an opinionated collection of R packages designed for data science. All packages share an underlying design philosophy, grammar, and data structures.</p>
</blockquote>
</section>
<section id="the-tidyverse-1" class="slide level2">
<h2>The tidyverse</h2>
<p>The tidyverse provides a set of packages which provides flexible tools for data manipulation.</p>
<center>
<img src="https://tidyverse.tidyverse.org/logo.png" width="200"/>
</center>
<center>
<img src="https://dplyr.tidyverse.org/logo.png" width="120"/> <img src="https://tidyr.tidyverse.org/logo.png" width="120"/> <img src="https://readr.tidyverse.org/logo.png" width="120"/> <img src="https://readxl.tidyverse.org/logo.png" width="120"/> <img src="https://ggplot2.tidyverse.org/logo.png" width="120"/><img src="https://stringr.tidyverse.org/logo.png" width="120"/><img src="https://lubridate.tidyverse.org/logo.png" width="120"/>
</center>
</section>
<section id="the-tidyverse-2" class="slide level2">
<h2>The tidyverse</h2>
<p>The package is not included in the base installation of R.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>) <span class="co"># Install the tidyverse packages</span></a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># Load all the packages inncluded in tidyverse</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<p>You can refer to the printed <strong>cheat sheet</strong> for an overview of the package’s functions.</p>
</section>
<section id="dplyr" class="slide level2">
<h2>dplyr</h2>
<p>All dplyr functions use the same scheme: the first argument to provide is a data frame.</p>
<table>
<colgroup>
<col style="width: 14%" />
<col style="width: 85%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Function</strong></th>
<th><strong>Definition</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>filter(df, …)</td>
<td>Select a subset of the rows of a data frame.</td>
</tr>
<tr class="even">
<td>arrange(df, …)</td>
<td>Reorder rows of a data frame.</td>
</tr>
<tr class="odd">
<td>select(df, …)</td>
<td>Select columns of a data frame.</td>
</tr>
<tr class="even">
<td>mutate(df, …)</td>
<td>Add new columns to a data frame.</td>
</tr>
<tr class="odd">
<td>summarise(df, …)</td>
<td>Summarize a data frame into a single row. This function is very helpful in combination with the group_by() function.</td>
</tr>
<tr class="even">
<td>group_by(df, …)</td>
<td>Group a data frame based on the specified columns.</td>
</tr>
</tbody>
</table>
</section>
<section id="lets-practice" class="slide level2">
<h2>Lets practice!</h2>
<p>To learn how to use these functions, we will use datasets from package <code>nycflights13</code> which we first need to install.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;nycflights13&quot;</span>) <span class="co"># Install a dataset package</span></a></code></pre></div>
</section>
<section id="nycflights13" class="slide level2">
<h2>nycflights13</h2>
<p>This package contains information about all flights that departed from New York (i.e., EWR, JFK and LGA) in 2013.</p>
<p>For the following examples we are going to use <strong>fights</strong>, <strong>planes</strong>, <strong>airports</strong>, <strong>airlines</strong> tables.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">library</span>(nycflights13) <span class="co"># Load the data, look at your workspace</span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="kw">data</span>(flights)</a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="kw">data</span>(planes)</a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="kw">data</span>(airports)</a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="kw">data</span>(airlines)</a></code></pre></div>
</section>
<section id="exploring-the-data" class="slide level2">
<h2>Exploring the data</h2>
</section>
<section id="flights" class="slide level2">
<h2>flights</h2>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw">str</span>(flights)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    336776 obs. of  19 variables:
##  $ year          : int  2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...
##  $ month         : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ day           : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ dep_time      : int  517 533 542 544 554 554 555 557 557 558 ...
##  $ sched_dep_time: int  515 529 540 545 600 558 600 600 600 600 ...
##  $ dep_delay     : num  2 4 2 -1 -6 -4 -5 -3 -3 -2 ...
##  $ arr_time      : int  830 850 923 1004 812 740 913 709 838 753 ...
##  $ sched_arr_time: int  819 830 850 1022 837 728 854 723 846 745 ...
##  $ arr_delay     : num  11 20 33 -18 -25 12 19 -14 -8 8 ...
##  $ carrier       : chr  &quot;UA&quot; &quot;UA&quot; &quot;AA&quot; &quot;B6&quot; ...
##  $ flight        : int  1545 1714 1141 725 461 1696 507 5708 79 301 ...
##  $ tailnum       : chr  &quot;N14228&quot; &quot;N24211&quot; &quot;N619AA&quot; &quot;N804JB&quot; ...
##  $ origin        : chr  &quot;EWR&quot; &quot;LGA&quot; &quot;JFK&quot; &quot;JFK&quot; ...
##  $ dest          : chr  &quot;IAH&quot; &quot;IAH&quot; &quot;MIA&quot; &quot;BQN&quot; ...
##  $ air_time      : num  227 227 160 183 116 150 158 53 140 138 ...
##  $ distance      : num  1400 1416 1089 1576 762 ...
##  $ hour          : num  5 5 5 5 6 5 6 6 6 6 ...
##  $ minute        : num  15 29 40 45 0 58 0 0 0 0 ...
##  $ time_hour     : POSIXct, format: &quot;2013-01-01 05:00:00&quot; &quot;2013-01-01 05:00:00&quot; &quot;2013-01-01 05:00:00&quot; &quot;2013-01-01 05:00:00&quot; ...</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">?flights <span class="co"># Description of all variables included in the data frame</span></a></code></pre></div>
</section>
<section id="planes" class="slide level2">
<h2>planes</h2>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw">str</span>(planes)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    3322 obs. of  9 variables:
##  $ tailnum     : chr  &quot;N10156&quot; &quot;N102UW&quot; &quot;N103US&quot; &quot;N104UW&quot; ...
##  $ year        : int  2004 1998 1999 1999 2002 1999 1999 1999 1999 1999 ...
##  $ type        : chr  &quot;Fixed wing multi engine&quot; &quot;Fixed wing multi engine&quot; &quot;Fixed wing multi engine&quot; &quot;Fixed wing multi engine&quot; ...
##  $ manufacturer: chr  &quot;EMBRAER&quot; &quot;AIRBUS INDUSTRIE&quot; &quot;AIRBUS INDUSTRIE&quot; &quot;AIRBUS INDUSTRIE&quot; ...
##  $ model       : chr  &quot;EMB-145XR&quot; &quot;A320-214&quot; &quot;A320-214&quot; &quot;A320-214&quot; ...
##  $ engines     : int  2 2 2 2 2 2 2 2 2 2 ...
##  $ seats       : int  55 182 182 182 55 182 182 182 182 182 ...
##  $ speed       : int  NA NA NA NA NA NA NA NA NA NA ...
##  $ engine      : chr  &quot;Turbo-fan&quot; &quot;Turbo-fan&quot; &quot;Turbo-fan&quot; &quot;Turbo-fan&quot; ...</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">?planes <span class="co"># Description of all variables included in the data frame</span></a></code></pre></div>
</section>
<section id="airports" class="slide level2">
<h2>airports</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">str</span>(airports)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    1458 obs. of  8 variables:
##  $ faa  : chr  &quot;04G&quot; &quot;06A&quot; &quot;06C&quot; &quot;06N&quot; ...
##  $ name : chr  &quot;Lansdowne Airport&quot; &quot;Moton Field Municipal Airport&quot; &quot;Schaumburg Regional&quot; &quot;Randall Airport&quot; ...
##  $ lat  : num  41.1 32.5 42 41.4 31.1 ...
##  $ lon  : num  -80.6 -85.7 -88.1 -74.4 -81.4 ...
##  $ alt  : int  1044 264 801 523 11 1593 730 492 1000 108 ...
##  $ tz   : num  -5 -6 -6 -5 -5 -5 -5 -5 -5 -8 ...
##  $ dst  : chr  &quot;A&quot; &quot;A&quot; &quot;A&quot; &quot;A&quot; ...
##  $ tzone: chr  &quot;America/New_York&quot; &quot;America/Chicago&quot; &quot;America/Chicago&quot; &quot;America/New_York&quot; ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   id = col_integer(),
##   ..   name = col_character(),
##   ..   city = col_character(),
##   ..   country = col_character(),
##   ..   faa = col_character(),
##   ..   icao = col_character(),
##   ..   lat = col_double(),
##   ..   lon = col_double(),
##   ..   alt = col_integer(),
##   ..   tz = col_double(),
##   ..   dst = col_character(),
##   ..   tzone = col_character()
##   .. )</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">?airports <span class="co"># Description of all variables included in the data frame</span></a></code></pre></div>
</section>
<section id="airlines" class="slide level2">
<h2>airlines</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">str</span>(airlines)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    16 obs. of  2 variables:
##  $ carrier: chr  &quot;9E&quot; &quot;AA&quot; &quot;AS&quot; &quot;B6&quot; ...
##  $ name   : chr  &quot;Endeavor Air Inc.&quot; &quot;American Airlines Inc.&quot; &quot;Alaska Airlines Inc.&quot; &quot;JetBlue Airways&quot; ...</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">?airlines <span class="co"># Description of all variables included in the data frame</span></a></code></pre></div>
</section>
<section id="relationships-between-tables" class="slide level2">
<h2>Relationships between tables</h2>
<p><img data-src="https://bookdown.org/asmundhreinn/r4ds-master/diagrams/relational-nycflights.png" /></p>
</section>
<section id="filtering-data" class="slide level2">
<h2>Filtering data</h2>
</section>
<section id="filter" class="slide level2">
<h2>filter</h2>
<p>Most of the time you will want to work on subset observations of your data.</p>
<ul>
<li class="fragment"><p><code>filter()</code> allows you to select a subset of the rows of a data frame.</p></li>
<li class="fragment"><p>The first argument is the name of the data frame, and the second and subsequent are filtering expressions evaluated in the context of that data frame.</p></li>
</ul>
</section>
<section id="example" class="slide level2">
<h2>Example</h2>
<h4 id="select-all-flights-with-tail-number-equal-to-n14228.">Select all flights with tail number equal to “N14228”.</h4>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">filter</span>(flights, tailnum <span class="op">==</span><span class="st"> &quot;N14228&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 111 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     8     1435           1440        -5     1717           1746       -29 UA        1579 N14228  EWR    MIA        150     1085    14
##  3  2013     1     9      717            700        17      812            815        -3 UA        1142 N14228  EWR    BOS         39      200     7
##  4  2013     1     9     1143           1144        -1     1425           1445       -20 UA        1707 N14228  EWR    TPA        149      997    11
##  5  2013     1    13      835            824        11     1030            951        39 UA        1572 N14228  EWR    BOS         43      200     8
##  6  2013     1    16     1829           1730        59     2117           2023        54 UA        1637 N14228  EWR    TPA        144      997    17
##  7  2013     1    22     1902           1808        54     2214           2106        68 UA        1269 N14228  EWR    PBI        163     1023    18
##  8  2013     1    23     1050           1056        -6     1143           1208       -25 UA        1047 N14228  EWR    BOS         39      200    10
##  9  2013     1    23     1533           1529         4     1641           1645        -4 UA        1116 N14228  EWR    BOS         47      200    15
## 10  2013     1    25      724            720         4     1000           1023       -23 UA        1724 N14228  EWR    PBI        137     1023     7
## # … with 101 more rows, and 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="example-1" class="slide level2">
<h2>Example</h2>
<h4 id="select-all-flights-with-a-departure-delay-180-minutes.">Select all flights with a departure delay &gt;= 180 minutes.</h4>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">filter</span>(flights, dep_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">180</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3,945 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      848           1835       853     1001           1950       851 MQ        3944 N942MQ  JFK    BWI         41      184    18
##  2  2013     1     1     1815           1325       290     2120           1542       338 EV        4417 N17185  EWR    OMA        213     1134    13
##  3  2013     1     1     1842           1422       260     1958           1535       263 EV        4633 N18120  EWR    BTV         46      266    14
##  4  2013     1     1     2006           1630       216     2230           1848       222 EV        4644 N14972  EWR    SAV        121      708    16
##  5  2013     1     1     2115           1700       255     2330           1920       250 9E        3347 N924XJ  JFK    CVG        115      589    17
##  6  2013     1     1     2205           1720       285       46           2040       246 AA        1999 N5DNAA  EWR    MIA        146     1085    17
##  7  2013     1     1     2312           2000       192       21           2110       191 EV        4312 N13958  EWR    DCA         44      199    20
##  8  2013     1     1     2343           1724       379      314           1938       456 EV        4321 N21197  EWR    MCI        222     1092    17
##  9  2013     1     2     1244            900       224     1431           1104       207 EV        4412 N13958  EWR    MYR         94      550     9
## 10  2013     1     2     1332            904       268     1616           1128       288 EV        4364 N41104  EWR    MCI        203     1092     9
## # … with 3,935 more rows, and 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="example-2" class="slide level2">
<h2>Example</h2>
<h4 id="select-all-flights-from-carriers-mq-or-ev.">Select all flights from carriers “MQ” or “EV”.</h4>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">filter</span>(flights, carrier <span class="op">==</span><span class="st">  &quot;MQ&quot;</span> <span class="op">|</span><span class="st"> </span>carrier <span class="op">==</span><span class="st"> &quot;EV&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 80,570 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  2  2013     1     1      600            600         0      837            825        12 MQ        4650 N542MQ  LGA    ATL        134      762     6
##  3  2013     1     1      602            605        -3      821            805        16 MQ        4401 N730MQ  LGA    DTW        105      502     6
##  4  2013     1     1      608            600         8      807            735        32 MQ        3768 N9EAMQ  EWR    ORD        139      719     6
##  5  2013     1     1      624            630        -6      909            840        29 EV        4626 N11107  EWR    MSP        190     1008     6
##  6  2013     1     1      624            630        -6      840            830        10 MQ        4599 N518MQ  LGA    MSP        166     1020     6
##  7  2013     1     1      632            608        24      740            728        12 EV        4144 N13553  EWR    IAD         52      212     6
##  8  2013     1     1      656            705        -9     1007            940        27 MQ        4534 N722MQ  LGA    XNA        233     1147     7
##  9  2013     1     1      749            710        39      939            850        49 MQ        3737 N508MQ  EWR    ORD        148      719     7
## 10  2013     1     1      800            810       -10      949            955        -6 MQ        4406 N828MQ  JFK    RDU         80      427     8
## # … with 80,560 more rows, and 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="example-3" class="slide level2">
<h2>Example</h2>
<h4 id="select-all-flights-from-carriers-mq-or-ev.-1">Select all flights from carriers MQ OR EV.</h4>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">filter</span>(flights, carrier <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;MQ&quot;</span>, <span class="st">&quot;EV&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 80,570 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  2  2013     1     1      600            600         0      837            825        12 MQ        4650 N542MQ  LGA    ATL        134      762     6
##  3  2013     1     1      602            605        -3      821            805        16 MQ        4401 N730MQ  LGA    DTW        105      502     6
##  4  2013     1     1      608            600         8      807            735        32 MQ        3768 N9EAMQ  EWR    ORD        139      719     6
##  5  2013     1     1      624            630        -6      909            840        29 EV        4626 N11107  EWR    MSP        190     1008     6
##  6  2013     1     1      624            630        -6      840            830        10 MQ        4599 N518MQ  LGA    MSP        166     1020     6
##  7  2013     1     1      632            608        24      740            728        12 EV        4144 N13553  EWR    IAD         52      212     6
##  8  2013     1     1      656            705        -9     1007            940        27 MQ        4534 N722MQ  LGA    XNA        233     1147     7
##  9  2013     1     1      749            710        39      939            850        49 MQ        3737 N508MQ  EWR    ORD        148      719     7
## 10  2013     1     1      800            810       -10      949            955        -6 MQ        4406 N828MQ  JFK    RDU         80      427     8
## # … with 80,560 more rows, and 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="arrange" class="slide level2">
<h2>arrange</h2>
<ul>
<li><code>arrange()</code> works similarly to <code>filter()</code> except that instead of filtering or selecting rows, it reorders them.</li>
</ul>
<ul>
<li>The function takes a data frame, and a set of column names (or more complicated expressions) to order by.</li>
</ul>
</section>
<section id="example-4" class="slide level2">
<h2>Example</h2>
<h4 id="order-flights-on-the-departure-delay.">Order flights on the departure delay.</h4>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">arrange</span>(flights, dep_delay)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013    12     7     2040           2123       -43       40           2352        48 B6          97 N592JB  JFK    DEN        265     1626    21
##  2  2013     2     3     2022           2055       -33     2240           2338       -58 DL        1715 N612DL  LGA    MSY        162     1183    20
##  3  2013    11    10     1408           1440       -32     1549           1559       -10 EV        5713 N825AS  LGA    IAD         52      229    14
##  4  2013     1    11     1900           1930       -30     2233           2243       -10 DL        1435 N934DL  LGA    TPA        139     1010    19
##  5  2013     1    29     1703           1730       -27     1947           1957       -10 F9         837 N208FR  LGA    DEN        250     1620    17
##  6  2013     8     9      729            755       -26     1002            955         7 MQ        3478 N711MQ  LGA    DTW         88      502     7
##  7  2013    10    23     1907           1932       -25     2143           2143         0 EV        4361 N13994  EWR    TYS        111      631    19
##  8  2013     3    30     2030           2055       -25     2213           2250       -37 MQ        4573 N725MQ  LGA    DTW         87      502    20
##  9  2013     3     2     1431           1455       -24     1601           1631       -30 9E        3318 N929XJ  JFK    BUF         55      301    14
## 10  2013     5     5      934            958       -24     1225           1309       -44 B6         375 N531JB  LGA    FLL        150     1076     9
## # … with 336,766 more rows, and 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="example-5" class="slide level2">
<h2>Example</h2>
<h4 id="order-flights-on-the-departure-delay-and-by-arrival-delay">Order flights on the departure delay and by arrival delay</h4>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">arrange</span>(flights, dep_delay, arr_delay)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013    12     7     2040           2123       -43       40           2352        48 B6          97 N592JB  JFK    DEN        265     1626    21
##  2  2013     2     3     2022           2055       -33     2240           2338       -58 DL        1715 N612DL  LGA    MSY        162     1183    20
##  3  2013    11    10     1408           1440       -32     1549           1559       -10 EV        5713 N825AS  LGA    IAD         52      229    14
##  4  2013     1    11     1900           1930       -30     2233           2243       -10 DL        1435 N934DL  LGA    TPA        139     1010    19
##  5  2013     1    29     1703           1730       -27     1947           1957       -10 F9         837 N208FR  LGA    DEN        250     1620    17
##  6  2013     8     9      729            755       -26     1002            955         7 MQ        3478 N711MQ  LGA    DTW         88      502     7
##  7  2013     3    30     2030           2055       -25     2213           2250       -37 MQ        4573 N725MQ  LGA    DTW         87      502    20
##  8  2013    10    23     1907           1932       -25     2143           2143         0 EV        4361 N13994  EWR    TYS        111      631    19
##  9  2013     5     5      934            958       -24     1225           1309       -44 B6         375 N531JB  LGA    FLL        150     1076     9
## 10  2013     9    18     1631           1655       -24     1812           1845       -33 AA        2223 N4XXAA  LGA    STL        125      888    16
## # … with 336,766 more rows, and 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="example-6" class="slide level2">
<h2>Example</h2>
<h4 id="order-flights-on-the-departure-delay-and-by-decreasing-arrival-delay">Order flights on the departure delay and by <em>decreasing</em> arrival delay</h4>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">arrange</span>(flights, dep_delay, <span class="kw">desc</span>(arr_delay)) <span class="co"># Using desc()</span></a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013    12     7     2040           2123       -43       40           2352        48 B6          97 N592JB  JFK    DEN        265     1626    21
##  2  2013     2     3     2022           2055       -33     2240           2338       -58 DL        1715 N612DL  LGA    MSY        162     1183    20
##  3  2013    11    10     1408           1440       -32     1549           1559       -10 EV        5713 N825AS  LGA    IAD         52      229    14
##  4  2013     1    11     1900           1930       -30     2233           2243       -10 DL        1435 N934DL  LGA    TPA        139     1010    19
##  5  2013     1    29     1703           1730       -27     1947           1957       -10 F9         837 N208FR  LGA    DEN        250     1620    17
##  6  2013     8     9      729            755       -26     1002            955         7 MQ        3478 N711MQ  LGA    DTW         88      502     7
##  7  2013    10    23     1907           1932       -25     2143           2143         0 EV        4361 N13994  EWR    TYS        111      631    19
##  8  2013     3    30     2030           2055       -25     2213           2250       -37 MQ        4573 N725MQ  LGA    DTW         87      502    20
##  9  2013     5    14      914            938       -24     1143           1204       -21 9E        4065 N8747B  LGA    SDF        107      659     9
## 10  2013     3     2     1431           1455       -24     1601           1631       -30 9E        3318 N929XJ  JFK    BUF         55      301    14
## # … with 336,766 more rows, and 2 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</section>
<section id="select" class="slide level2">
<h2>select</h2>
<ul>
<li><code>select()</code> is used to extract columns from a data frame.</li>
<li>Useful when you want to perform data analysis on specific columns and not the complete dataset.</li>
</ul>
</section>
<section id="example-7" class="slide level2">
<h2>Example</h2>
<h4 id="select-faa-and-name-columns-from-the-airports-data-frame.">Select “faa” and “name” columns from the airports data frame.</h4>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">select</span>(airports, faa, name)</a></code></pre></div>
<pre><code>## # A tibble: 1,458 x 2
##    faa   name                          
##    &lt;chr&gt; &lt;chr&gt;                         
##  1 04G   Lansdowne Airport             
##  2 06A   Moton Field Municipal Airport 
##  3 06C   Schaumburg Regional           
##  4 06N   Randall Airport               
##  5 09J   Jekyll Island Airport         
##  6 0A9   Elizabethton Municipal Airport
##  7 0G6   Williams County Airport       
##  8 0G7   Finger Lakes Regional Airport 
##  9 0P2   Shoestring Aviation Airfield  
## 10 0S9   Jefferson County Intl         
## # … with 1,448 more rows</code></pre>
</section>
<section id="example-8" class="slide level2">
<h2>Example</h2>
<p>You can also use <code>select()</code> to remove columns by using <code>-</code> in front of the columns you want to remove.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">select</span>(airports, <span class="op">-</span>faa, <span class="op">-</span>name)</a></code></pre></div>
<pre><code>## # A tibble: 1,458 x 6
##      lat    lon   alt    tz dst   tzone              
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              
##  1  41.1  -80.6  1044    -5 A     America/New_York   
##  2  32.5  -85.7   264    -6 A     America/Chicago    
##  3  42.0  -88.1   801    -6 A     America/Chicago    
##  4  41.4  -74.4   523    -5 A     America/New_York   
##  5  31.1  -81.4    11    -5 A     America/New_York   
##  6  36.4  -82.2  1593    -5 A     America/New_York   
##  7  41.5  -84.5   730    -5 A     America/New_York   
##  8  42.9  -76.8   492    -5 A     America/New_York   
##  9  39.8  -76.6  1000    -5 U     America/New_York   
## 10  48.1 -123.    108    -8 A     America/Los_Angeles
## # … with 1,448 more rows</code></pre>
</section>
<section id="mutate-and-transmute" class="slide level2">
<h2>mutate and transmute</h2>
<ul>
<li>The <code>mutate()</code> and <code>transmute()</code> functions are used to add columns to a data frame.</li>
<li>The difference between both functions is that mutate adds new variables and preserves existing while transmute drops existing variables.</li>
</ul>
</section>
<section id="example-9" class="slide level2">
<h2>Example</h2>
<h4 id="add-a-new-column-named-distance_km-which-converts-mile-distances-into-km-distances.">Add a new column named “distance_km” which converts mile distances into km distances.</h4>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw">mutate</span>(flights, <span class="dt">distance_km =</span> distance <span class="op">/</span><span class="st"> </span><span class="fl">0.62137</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay carrier flight tailnum origin dest  air_time distance  hour
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1      517            515         2      830            819        11 UA        1545 N14228  EWR    IAH        227     1400     5
##  2  2013     1     1      533            529         4      850            830        20 UA        1714 N24211  LGA    IAH        227     1416     5
##  3  2013     1     1      542            540         2      923            850        33 AA        1141 N619AA  JFK    MIA        160     1089     5
##  4  2013     1     1      544            545        -1     1004           1022       -18 B6         725 N804JB  JFK    BQN        183     1576     5
##  5  2013     1     1      554            600        -6      812            837       -25 DL         461 N668DN  LGA    ATL        116      762     6
##  6  2013     1     1      554            558        -4      740            728        12 UA        1696 N39463  EWR    ORD        150      719     5
##  7  2013     1     1      555            600        -5      913            854        19 B6         507 N516JB  EWR    FLL        158     1065     6
##  8  2013     1     1      557            600        -3      709            723       -14 EV        5708 N829AS  LGA    IAD         53      229     6
##  9  2013     1     1      557            600        -3      838            846        -8 B6          79 N593JB  JFK    MCO        140      944     6
## 10  2013     1     1      558            600        -2      753            745         8 AA         301 N3ALAA  LGA    ORD        138      733     6
## # … with 336,766 more rows, and 3 more variables: minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, distance_km &lt;dbl&gt;</code></pre>
</section>
<section id="example-10" class="slide level2">
<h2>Example</h2>
<p><code>transmute()</code> drops all other columns.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">transmute</span>(flights, <span class="dt">distance_km =</span> distance <span class="op">/</span><span class="st"> </span><span class="fl">0.62137</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    distance_km
##          &lt;dbl&gt;
##  1       2253.
##  2       2279.
##  3       1753.
##  4       2536.
##  5       1226.
##  6       1157.
##  7       1714.
##  8        369.
##  9       1519.
## 10       1180.
## # … with 336,766 more rows</code></pre>
</section>
<section id="example-11" class="slide level2">
<h2>Example</h2>
<p>It is also possible to add many new variable in a single operation.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"><span class="kw">transmute</span>(flights, <span class="dt">distance_km =</span> distance <span class="op">/</span><span class="st"> </span><span class="fl">0.62137</span>,</a>
<a class="sourceLine" id="cb62-2" data-line-number="2">          <span class="dt">distance_knot =</span> distance <span class="op">/</span><span class="st"> </span><span class="fl">1.15078</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    distance_km distance_knot
##          &lt;dbl&gt;         &lt;dbl&gt;
##  1       2253.         1217.
##  2       2279.         1230.
##  3       1753.          946.
##  4       2536.         1370.
##  5       1226.          662.
##  6       1157.          625.
##  7       1714.          925.
##  8        369.          199.
##  9       1519.          820.
## 10       1180.          637.
## # … with 336,766 more rows</code></pre>
</section>
<section id="summarise" class="slide level2">
<h2>summarise</h2>
<ul>
<li>The <code>summarise()</code> function allows to summarise columns from a dataframe.</li>
<li><strong>Compress</strong> a data frame into single values (i.e. one row).</li>
</ul>
<p>Hence, you have to provide a function that will be used to calculate a certain value.</p>
</section>
<section id="example-12" class="slide level2">
<h2>Example</h2>
<h4 id="calculate-the-average-departure-and-arrival-delays-in-the-flights-table.">Calculate the average departure and arrival delays in the flights table.</h4>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">summarise</span>(flights,</a>
<a class="sourceLine" id="cb64-2" data-line-number="2">          <span class="dt">average_departure_delay =</span> <span class="kw">mean</span>(dep_delay),</a>
<a class="sourceLine" id="cb64-3" data-line-number="3">          <span class="dt">average_arrival_delay =</span> <span class="kw">mean</span>(arr_delay))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   average_departure_delay average_arrival_delay
##                     &lt;dbl&gt;                 &lt;dbl&gt;
## 1                      NA                    NA</code></pre>
<p>What is going on?</p>
</section>
<section id="example-13" class="slide level2">
<h2>Example</h2>
<h4 id="calculate-the-average-departure-and-arrival-delays-in-the-flights-table.-1">Calculate the average departure and arrival delays in the flights table.</h4>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">summarise</span>(flights,</a>
<a class="sourceLine" id="cb66-2" data-line-number="2">          <span class="dt">average_departure_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb66-3" data-line-number="3">          <span class="dt">average_arrival_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   average_departure_delay average_arrival_delay
##                     &lt;dbl&gt;                 &lt;dbl&gt;
## 1                    12.6                  6.90</code></pre>
</section>
<section id="working-with-grouped-data" class="slide level2">
<h2>Working with grouped data</h2>
<ul>
<li>Alone, the <code>summarise()</code> function is not really helpful because it collapses a data frame to a single row.</li>
<li>Usually we want to work on grouped data.</li>
<li><code>group_by()</code> “prepares” a data frame to send it to the <code>summarise()</code> function.</li>
</ul>
</section>
<section id="example-14" class="slide level2">
<h2>Example</h2>
<h4 id="calculate-the-average-departure-delay-for-each-carrier.">Calculate the average departure delay for each carrier.</h4>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">grouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, carrier) <span class="co"># Group flights by carrier</span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2"></a>
<a class="sourceLine" id="cb68-3" data-line-number="3"><span class="kw">summarise</span>(grouped, </a>
<a class="sourceLine" id="cb68-4" data-line-number="4">          <span class="dt">average_departure_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
</section>
<section class="slide level2">

<pre><code>## # A tibble: 16 x 2
##    carrier average_departure_delay
##    &lt;chr&gt;                     &lt;dbl&gt;
##  1 9E                        16.7 
##  2 AA                         8.59
##  3 AS                         5.80
##  4 B6                        13.0 
##  5 DL                         9.26
##  6 EV                        20.0 
##  7 F9                        20.2 
##  8 FL                        18.7 
##  9 HA                         4.90
## 10 MQ                        10.6 
## 11 OO                        12.6 
## 12 UA                        12.1 
## 13 US                         3.78
## 14 VX                        12.9 
## 15 WN                        17.7 
## 16 YV                        19.0</code></pre>
</section>
<section id="example-15" class="slide level2">
<h2>Example</h2>
<p>It might be interested to know how many observations were used in each group to compute the average. To do so, we can use the <code>n()</code> function.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">grouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, carrier) <span class="co"># Group flights by carrier</span></a>
<a class="sourceLine" id="cb70-2" data-line-number="2"></a>
<a class="sourceLine" id="cb70-3" data-line-number="3"><span class="kw">summarise</span>(grouped, </a>
<a class="sourceLine" id="cb70-4" data-line-number="4">          <span class="dt">average_departure_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb70-5" data-line-number="5">          <span class="dt">number_of_observation =</span> <span class="kw">n</span>())</a></code></pre></div>
</section>
<section class="slide level2">

<pre><code>## # A tibble: 16 x 3
##    carrier average_departure_delay number_of_observation
##    &lt;chr&gt;                     &lt;dbl&gt;                 &lt;int&gt;
##  1 9E                        16.7                  18460
##  2 AA                         8.59                 32729
##  3 AS                         5.80                   714
##  4 B6                        13.0                  54635
##  5 DL                         9.26                 48110
##  6 EV                        20.0                  54173
##  7 F9                        20.2                    685
##  8 FL                        18.7                   3260
##  9 HA                         4.90                   342
## 10 MQ                        10.6                  26397
## 11 OO                        12.6                     32
## 12 UA                        12.1                  58665
## 13 US                         3.78                 20536
## 14 VX                        12.9                   5162
## 15 WN                        17.7                  12275
## 16 YV                        19.0                    601</code></pre>
</section>
<section id="example-16" class="slide level2">
<h2>Example</h2>
<p>It is possible to summarise more than one column at once.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">grouped &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, carrier) <span class="co"># Group flights by carrier</span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2"></a>
<a class="sourceLine" id="cb72-3" data-line-number="3"><span class="kw">summarise</span>(grouped,</a>
<a class="sourceLine" id="cb72-4" data-line-number="4">          <span class="dt">number_of_flight =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">          <span class="dt">average_departure_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb72-6" data-line-number="6">          <span class="dt">min_delay =</span> <span class="kw">min</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb72-7" data-line-number="7">          <span class="dt">max_delay =</span> <span class="kw">max</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
</section>
<section class="slide level2">

<pre><code>## # A tibble: 16 x 5
##    carrier number_of_flight average_departure_delay min_delay max_delay
##    &lt;chr&gt;              &lt;int&gt;                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1 9E                 18460                   16.7        -24       747
##  2 AA                 32729                    8.59       -24      1014
##  3 AS                   714                    5.80       -21       225
##  4 B6                 54635                   13.0        -43       502
##  5 DL                 48110                    9.26       -33       960
##  6 EV                 54173                   20.0        -32       548
##  7 F9                   685                   20.2        -27       853
##  8 FL                  3260                   18.7        -22       602
##  9 HA                   342                    4.90       -16      1301
## 10 MQ                 26397                   10.6        -26      1137
## 11 OO                    32                   12.6        -14       154
## 12 UA                 58665                   12.1        -20       483
## 13 US                 20536                    3.78       -19       500
## 14 VX                  5162                   12.9        -20       653
## 15 WN                 12275                   17.7        -13       471
## 16 YV                   601                   19.0        -16       387</code></pre>
</section>
<section id="exercise-2" class="slide level2 exercises">
<h2>Exercise</h2>
<p>For this exercise, we will look at statistics of R packages downloaded on 2015-11-21. You can load the data as follow:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">downloads &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/2018-07-15.csv.gz&quot;</span>) </a></code></pre></div>
<h4 id="question-1">Question #1</h4>
<p>Which package has been downloaded the most that day?</p>
</section>
<section id="exercise-3" class="slide level2 exercises">
<h2>Exercise</h2>
<h4 id="question-2">Question #2</h4>
<p>From which countries people downloaded the most packages?</p>
</section>
<section id="exercise-4" class="slide level2 exercises">
<h2>Exercise</h2>
<h4 id="question-3">Question #3</h4>
<p>How many packages have been downloaded that day from people in Denmark?</p>
</section>
<section id="joining-tables" class="slide level2">
<h2>Joining tables</h2>
</section>
<section id="joining-tables-1" class="slide level2">
<h2>Joining tables</h2>
<ul>
<li class="fragment"><p>Data are rarely stored in a single data frame.</p></li>
<li class="fragment"><p>Good database practices recommend to have similar data in separate tables.</p></li>
<li class="fragment"><p>Joins are used to “merge” data frame together.</p></li>
</ul>
</section>
<section id="joins-in-r" class="slide level2">
<h2>Joins in R</h2>
<p>There are many ways of joining tables (data frames) in R. We will however focus on the merging tools offered by the package <code>dplyr</code>.</p>
</section>
<section id="types-of-join" class="slide level2">
<h2>Types of join</h2>
<center>
<figure>
<p><img style="margin:0px auto;display:block" src="myfigs/join_types.svg" width = "700"/></p>
<figcaption>
Source: <a href="http://bit.ly/1QZ8Oil" class="uri">http://bit.ly/1QZ8Oil</a>
</figcaption>
</figure>
</center>
</section>
<section id="examples-1" class="slide level2">
<h2>Examples</h2>
<p>To understand how joins work we will create two small data frames from data in <code>nycflights13</code>.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">flights2 &lt;-<span class="st"> </span><span class="kw">select</span>(flights, year, month, day, hour, origin)</a>
<a class="sourceLine" id="cb75-2" data-line-number="2">flights2</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 5
##     year month   day  hour origin
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; 
##  1  2013     1     1     5 EWR   
##  2  2013     1     1     5 LGA   
##  3  2013     1     1     5 JFK   
##  4  2013     1     1     5 JFK   
##  5  2013     1     1     6 LGA   
##  6  2013     1     1     5 EWR   
##  7  2013     1     1     6 EWR   
##  8  2013     1     1     6 LGA   
##  9  2013     1     1     6 JFK   
## 10  2013     1     1     6 LGA   
## # … with 336,766 more rows</code></pre>
</section>
<section id="examples-2" class="slide level2">
<h2>Examples</h2>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">airports2 &lt;-<span class="st"> </span><span class="kw">select</span>(airports, faa, name)</a>
<a class="sourceLine" id="cb77-2" data-line-number="2">airports2</a></code></pre></div>
<pre><code>## # A tibble: 1,458 x 2
##    faa   name                          
##    &lt;chr&gt; &lt;chr&gt;                         
##  1 04G   Lansdowne Airport             
##  2 06A   Moton Field Municipal Airport 
##  3 06C   Schaumburg Regional           
##  4 06N   Randall Airport               
##  5 09J   Jekyll Island Airport         
##  6 0A9   Elizabethton Municipal Airport
##  7 0G6   Williams County Airport       
##  8 0G7   Finger Lakes Regional Airport 
##  9 0P2   Shoestring Aviation Airfield  
## 10 0S9   Jefferson County Intl         
## # … with 1,448 more rows</code></pre>
</section>
<section id="left-join" class="slide level2">
<h2>left join</h2>
<p>With a left join, all observations from table A are keep and only observations from table B that match will be merged.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="co"># By default, dplyr will merge using all common columns.</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="kw">left_join</span>(flights2, airports2)</a></code></pre></div>
<pre><code>## Error: `by` required, because the data sources have no common variables
## Backtrace:
## [90m     [39m█
## [90m  1. [39m├─rmarkdown::render(...)
## [90m  2. [39m│ └─knitr::knit(...)
## [90m  3. [39m│   └─knitr:::process_file(text, output)
## [90m  4. [39m│     ├─base::withCallingHandlers(...)
## [90m  5. [39m│     ├─knitr:::process_group(group)
## [90m  6. [39m│     └─knitr:::process_group.block(group)
## [90m  7. [39m│       └─knitr:::call_block(x)
## [90m  8. [39m│         └─knitr:::block_exec(params)
## [90m  9. [39m│           ├─knitr:::in_dir(...)
## [90m 10. [39m│           └─knitr:::evaluate(...)
## [90m 11. [39m│             └─evaluate::evaluate(...)
## [90m 12. [39m│               └─evaluate:::evaluate_call(...)
## [90m 13. [39m│                 ├─evaluate:::timing_fn(...)
## [90m 14. [39m│                 ├─evaluate:::handle(...)
## [90m 15. [39m│                 │ └─base::try(f, silent = TRUE)
## [90m 16. [39m│                 │   └─base::tryCatch(...)
## [90m 17. [39m│                 │     └─base:::tryCatchList(expr, classes, parentenv, handlers)
## [90m 18. [39m│                 │       └─base:::tryCatchOne(expr, names, parentenv, handlers[[1L]])
## [90m 19. [39m│                 │         └─base:::doTryCatch(return(expr), name, parentenv, handler)
## [90m 20. [39m│                 ├─base::withCallingHandlers(...)
## [90m 21. [39m│                 ├─base::withVisible(eval(expr, envir, enclos))
## [90m 22. [39m│                 └─base::eval(expr, envir, enclos)
## [90m 23. [39m│                   └─base::eval(expr, envir, enclos)
## [90m 24. [39m├─dplyr::left_join(flights2, airports2)
## [90m 25. [39m└─dplyr:::left_join.tbl_df(flights2, airports2)
## [90m 26. [39m  ├─dplyr::common_by(by, x, y)
## [90m 27. [39m  └─dplyr:::common_by.NULL(by, x, y)
## [90m 28. [39m    └─dplyr:::bad_args(&quot;by&quot;, &quot;required, because the data sources have no common variables&quot;)
## [90m 29. [39m      └─dplyr:::glubort(fmt_args(args), ..., .envir = .envir)</code></pre>
</section>
<section id="left-join-1" class="slide level2">
<h2>left join</h2>
<p>With a left join, all observations from table A are keep and only observations from table B that match will be merged.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="co"># By default, dplyr will merge using all commun columns.</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="kw">left_join</span>(flights2, airports2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##     year month   day  hour origin name               
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;              
##  1  2013     1     1     5 EWR    Newark Liberty Intl
##  2  2013     1     1     5 LGA    La Guardia         
##  3  2013     1     1     5 JFK    John F Kennedy Intl
##  4  2013     1     1     5 JFK    John F Kennedy Intl
##  5  2013     1     1     6 LGA    La Guardia         
##  6  2013     1     1     5 EWR    Newark Liberty Intl
##  7  2013     1     1     6 EWR    Newark Liberty Intl
##  8  2013     1     1     6 LGA    La Guardia         
##  9  2013     1     1     6 JFK    John F Kennedy Intl
## 10  2013     1     1     6 LGA    La Guardia         
## # … with 336,766 more rows</code></pre>
</section>
<section id="left-join-2" class="slide level2">
<h2>left join</h2>
<p><strong>Attention, the order is important!</strong></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">left_join</span>(airports2, flights2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;faa&quot;</span> =<span class="st"> &quot;origin&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 338,231 x 6
##    faa   name                            year month   day  hour
##    &lt;chr&gt; &lt;chr&gt;                          &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1 04G   Lansdowne Airport                 NA    NA    NA    NA
##  2 06A   Moton Field Municipal Airport     NA    NA    NA    NA
##  3 06C   Schaumburg Regional               NA    NA    NA    NA
##  4 06N   Randall Airport                   NA    NA    NA    NA
##  5 09J   Jekyll Island Airport             NA    NA    NA    NA
##  6 0A9   Elizabethton Municipal Airport    NA    NA    NA    NA
##  7 0G6   Williams County Airport           NA    NA    NA    NA
##  8 0G7   Finger Lakes Regional Airport     NA    NA    NA    NA
##  9 0P2   Shoestring Aviation Airfield      NA    NA    NA    NA
## 10 0S9   Jefferson County Intl             NA    NA    NA    NA
## # … with 338,221 more rows</code></pre>
</section>
<section id="right-join" class="slide level2">
<h2>right join</h2>
<p>With a right join, all observations from table B are keep and only observations from table A that match will be merged.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="co"># This is the same as the previous &quot;inverted&quot; left join</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="kw">right_join</span>(flights2, airports2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 338,231 x 6
##     year month   day  hour origin name                          
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;                         
##  1    NA    NA    NA    NA 04G    Lansdowne Airport             
##  2    NA    NA    NA    NA 06A    Moton Field Municipal Airport 
##  3    NA    NA    NA    NA 06C    Schaumburg Regional           
##  4    NA    NA    NA    NA 06N    Randall Airport               
##  5    NA    NA    NA    NA 09J    Jekyll Island Airport         
##  6    NA    NA    NA    NA 0A9    Elizabethton Municipal Airport
##  7    NA    NA    NA    NA 0G6    Williams County Airport       
##  8    NA    NA    NA    NA 0G7    Finger Lakes Regional Airport 
##  9    NA    NA    NA    NA 0P2    Shoestring Aviation Airfield  
## 10    NA    NA    NA    NA 0S9    Jefferson County Intl         
## # … with 338,221 more rows</code></pre>
</section>
<section id="inner-join" class="slide level2">
<h2>inner join</h2>
<p>With a inner join, only observations that match both tables are kept.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="co"># Here the order is not important.</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="kw">inner_join</span>(flights2, airports2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##     year month   day  hour origin name               
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;              
##  1  2013     1     1     5 EWR    Newark Liberty Intl
##  2  2013     1     1     5 LGA    La Guardia         
##  3  2013     1     1     5 JFK    John F Kennedy Intl
##  4  2013     1     1     5 JFK    John F Kennedy Intl
##  5  2013     1     1     6 LGA    La Guardia         
##  6  2013     1     1     5 EWR    Newark Liberty Intl
##  7  2013     1     1     6 EWR    Newark Liberty Intl
##  8  2013     1     1     6 LGA    La Guardia         
##  9  2013     1     1     6 JFK    John F Kennedy Intl
## 10  2013     1     1     6 LGA    La Guardia         
## # … with 336,766 more rows</code></pre>
</section>
<section id="full-join" class="slide level2">
<h2>full join</h2>
<p>With a full join, <strong>all observations</strong> from both tables are kept.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="kw">full_join</span>(flights2, airports2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 338,231 x 6
##     year month   day  hour origin name               
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;              
##  1  2013     1     1     5 EWR    Newark Liberty Intl
##  2  2013     1     1     5 LGA    La Guardia         
##  3  2013     1     1     5 JFK    John F Kennedy Intl
##  4  2013     1     1     5 JFK    John F Kennedy Intl
##  5  2013     1     1     6 LGA    La Guardia         
##  6  2013     1     1     5 EWR    Newark Liberty Intl
##  7  2013     1     1     6 EWR    Newark Liberty Intl
##  8  2013     1     1     6 LGA    La Guardia         
##  9  2013     1     1     6 JFK    John F Kennedy Intl
## 10  2013     1     1     6 LGA    La Guardia         
## # … with 338,221 more rows</code></pre>
</section>
<section id="anti-join" class="slide level2">
<h2>anti join</h2>
<p>With an anti join, only observations from table A that do not match table B are kept.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="co"># Which airports do not match flights.</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="kw">anti_join</span>(airports2, flights2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;faa&quot;</span> =<span class="st"> &quot;origin&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 1,455 x 2
##    faa   name                          
##    &lt;chr&gt; &lt;chr&gt;                         
##  1 04G   Lansdowne Airport             
##  2 06A   Moton Field Municipal Airport 
##  3 06C   Schaumburg Regional           
##  4 06N   Randall Airport               
##  5 09J   Jekyll Island Airport         
##  6 0A9   Elizabethton Municipal Airport
##  7 0G6   Williams County Airport       
##  8 0G7   Finger Lakes Regional Airport 
##  9 0P2   Shoestring Aviation Airfield  
## 10 0S9   Jefferson County Intl         
## # … with 1,445 more rows</code></pre>
</section>
<section id="exercise-5" class="slide level2 exercises">
<h2>Exercise</h2>
<h4 id="exercise-1-1">Exercise #1</h4>
<p>First, load the statistics of R packages downloaded on 2015-11-21 and countries ISO codes as follow:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="co"># http://cran-logs.rstudio.com/2018/2018-07-15.csv.gz</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2">downloads &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/2018-07-15.csv.gz&quot;</span>)</a>
<a class="sourceLine" id="cb93-3" data-line-number="3"></a>
<a class="sourceLine" id="cb93-4" data-line-number="4">countries &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/countries_ISO.csv&quot;</span>)</a></code></pre></div>
<p>From which countries <strong>there were no</strong> packages downloaded this particular date?</p>
</section>
<section id="tidy-data" class="slide level2">
<h2>Tidy data</h2>
</section>
<section id="tidy-data-1" class="slide level2">
<h2>Tidy data</h2>
<p>In a tidy data set, each row correspond to an <strong>observation</strong> whereas each column is a <strong>variable</strong>.</p>
<p>Tidying a dataset consists in cleaning and structuring datasets to facilitate analysis.</p>
</section>
<section id="what-is-a-messy-dataset" class="slide level2">
<h2>What is a messy dataset?</h2>
<p><small> <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html" class="uri">https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html</a> </small></p>
<p>There are five main common problems that define a messy dataset:</p>
<ol type="1">
<li class="fragment">Column headers are values, not variable names.</li>
<li class="fragment">Multiple variables are stored in one column.</li>
<li class="fragment">Variables are stored in both rows and columns.</li>
<li class="fragment">Multiple types of observational units are stored in the same table.</li>
<li class="fragment">A single observational unit is stored in multiple tables.</li>
</ol>
</section>
<section id="is-there-a-solution" class="slide level2">
<h2>Is there a solution?</h2>
<p>Of course! Most of these problems can be easily addressed with little effort using the <code>tidyr</code> package (included in tidyverse).</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"> <span class="co"># To install it alone if you have not installed tidyverse</span></a>
<a class="sourceLine" id="cb94-2" data-line-number="2"><span class="kw">install.packages</span>(<span class="st">&quot;tidyr&quot;</span>)</a>
<a class="sourceLine" id="cb94-3" data-line-number="3"><span class="kw">library</span>(tidyr)</a></code></pre></div>
<p>You can refer to the printed <strong>cheat sheet</strong> for an overview of the package’s functions.</p>
</section>
<section id="column-headers-are-values-not-variable-name" class="slide level2">
<h2>Column headers are values, not variable name</h2>
</section>
<section id="the-messy-data" class="slide level2">
<h2>The messy data</h2>
<p>The following dataset explores the relationship between income and religion in the US.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">messy &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://goo.gl/4rjDWu&quot;</span>)</a></code></pre></div>
</section>
<section id="the-messy-data-1" class="slide level2">
<h2>The messy data</h2>
<p>Take a minute to look at the following table to find what is the main problems.</p>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:57 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
religion
</th>
<th>
&lt;$10k
</th>
<th>
$10-20k
</th>
<th>
$20-30k
</th>
<th>
$30-40k
</th>
<th>
$40-50k
</th>
<th>
$50-75k
</th>
<th>
$75-100k
</th>
<th>
$100-150k
</th>
<th>
&gt;150k
</th>
<th>
Don’t know/refused
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
Agnostic
</td>
<td align="right">
27.00
</td>
<td align="right">
34.00
</td>
<td align="right">
60.00
</td>
<td align="right">
81.00
</td>
<td align="right">
76.00
</td>
<td align="right">
137.00
</td>
<td align="right">
122.00
</td>
<td align="right">
109.00
</td>
<td align="right">
84.00
</td>
<td align="right">
96.00
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
Atheist
</td>
<td align="right">
12.00
</td>
<td align="right">
27.00
</td>
<td align="right">
37.00
</td>
<td align="right">
52.00
</td>
<td align="right">
35.00
</td>
<td align="right">
70.00
</td>
<td align="right">
73.00
</td>
<td align="right">
59.00
</td>
<td align="right">
74.00
</td>
<td align="right">
76.00
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
Buddhist
</td>
<td align="right">
27.00
</td>
<td align="right">
21.00
</td>
<td align="right">
30.00
</td>
<td align="right">
34.00
</td>
<td align="right">
33.00
</td>
<td align="right">
58.00
</td>
<td align="right">
62.00
</td>
<td align="right">
39.00
</td>
<td align="right">
53.00
</td>
<td align="right">
54.00
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
Catholic
</td>
<td align="right">
418.00
</td>
<td align="right">
617.00
</td>
<td align="right">
732.00
</td>
<td align="right">
670.00
</td>
<td align="right">
638.00
</td>
<td align="right">
1116.00
</td>
<td align="right">
949.00
</td>
<td align="right">
792.00
</td>
<td align="right">
633.00
</td>
<td align="right">
1489.00
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
Don’t know/refused
</td>
<td align="right">
15.00
</td>
<td align="right">
14.00
</td>
<td align="right">
15.00
</td>
<td align="right">
11.00
</td>
<td align="right">
10.00
</td>
<td align="right">
35.00
</td>
<td align="right">
21.00
</td>
<td align="right">
17.00
</td>
<td align="right">
18.00
</td>
<td align="right">
116.00
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
Evangelical Prot
</td>
<td align="right">
575.00
</td>
<td align="right">
869.00
</td>
<td align="right">
1064.00
</td>
<td align="right">
982.00
</td>
<td align="right">
881.00
</td>
<td align="right">
1486.00
</td>
<td align="right">
949.00
</td>
<td align="right">
723.00
</td>
<td align="right">
414.00
</td>
<td align="right">
1529.00
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="the-problem" class="slide level2">
<h2>The problem</h2>
<h4 id="column-headers-are-values-not-variable-names">Column headers are values, not variable names</h4>
<p>What we need to do here is to <strong>gather</strong> information that is spread in the column names.</p>
<p>This is done using the <code>gather(df, key, value)</code> function where <code>df</code> is a data frame, <code>key</code> is the new column name that will contain the values of the data spread in the old dataframe and <code>value</code> is the name of the new column that will contain the actual values.</p>
<p>We can also specify variables that we do not need to tidy using the <code>-var</code> operator. In this case, <code>-religion</code>.</p>
</section>
<section id="gather" class="slide level2">
<h2>gather</h2>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="co"># Tidy the data frame (2 new columns and keep &quot;religion&quot; as is).</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2">fixed &lt;-<span class="st"> </span><span class="kw">gather</span>(messy, income, frequency, <span class="op">-</span>religion)</a></code></pre></div>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:58 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
religion
</th>
<th>
income
</th>
<th>
frequency
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
Agnostic
</td>
<td>
&lt;$10k
</td>
<td align="right">
27.00
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
Atheist
</td>
<td>
&lt;$10k
</td>
<td align="right">
12.00
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
Buddhist
</td>
<td>
&lt;$10k
</td>
<td align="right">
27.00
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
Catholic
</td>
<td>
&lt;$10k
</td>
<td align="right">
418.00
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
Don’t know/refused
</td>
<td>
&lt;$10k
</td>
<td align="right">
15.00
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
Evangelical Prot
</td>
<td>
&lt;$10k
</td>
<td align="right">
575.00
</td>
</tr>
<tr>
<td align="right">
7
</td>
<td>
Hindu
</td>
<td>
&lt;$10k
</td>
<td align="right">
1.00
</td>
</tr>
<tr>
<td align="right">
8
</td>
<td>
Historically Black Prot
</td>
<td>
&lt;$10k
</td>
<td align="right">
228.00
</td>
</tr>
<tr>
<td align="right">
9
</td>
<td>
Jehovah’s Witness
</td>
<td>
&lt;$10k
</td>
<td align="right">
20.00
</td>
</tr>
<tr>
<td align="right">
10
</td>
<td>
Jewish
</td>
<td>
&lt;$10k
</td>
<td align="right">
19.00
</td>
</tr>
</table>
<p></small></p>
<p><small> This new dataset is tidy each column represents a variable and each row represents an observation. We will later see how tidy data can be very useful for analysis and plotting (especially with ggplot2). </small></p>
</section>
<section id="multiple-variables-stored-in-one-column" class="slide level2">
<h2>Multiple variables stored in one column</h2>
</section>
<section id="the-messy-data-2" class="slide level2">
<h2>The messy data</h2>
<p>The following messy dataset comes from the World Health Organisation, and records the counts of confirmed tuberculosis cases between 1980 and 2008.</p>
<p>The demographic groups are broken down by sex (m, f) and age (0-14, 15-25, 25-34, 35-44, 45-54, 55-64, unknown).</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">messy &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://goo.gl/xyxnJU&quot;</span>)</a>
<a class="sourceLine" id="cb97-2" data-line-number="2">messy &lt;-<span class="st"> </span><span class="kw">select</span>(messy, <span class="op">-</span>new_sp) <span class="co"># Remove unneeded column</span></a></code></pre></div>
<p><small> <a href="http://www.who.int/tb/country/data/download/en/" class="uri">http://www.who.int/tb/country/data/download/en/</a> </small></p>
</section>
<section id="the-messy-data-3" class="slide level2">
<h2>The messy data</h2>
<p>Take a minute to look at the following table to find what are the main problems.</p>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:58 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
iso2
</th>
<th>
year
</th>
<th>
new_sp_m04
</th>
<th>
new_sp_m514
</th>
<th>
new_sp_m014
</th>
<th>
new_sp_m1524
</th>
<th>
new_sp_m2534
</th>
<th>
new_sp_m3544
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
AD
</td>
<td align="right">
1989.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
AD
</td>
<td align="right">
1990.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
AD
</td>
<td align="right">
1991.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
AD
</td>
<td align="right">
1992.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
AD
</td>
<td align="right">
1993.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
AD
</td>
<td align="right">
1994.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
7
</td>
<td>
AD
</td>
<td align="right">
1996.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
4.00
</td>
</tr>
<tr>
<td align="right">
8
</td>
<td>
AD
</td>
<td align="right">
1997.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
1.00
</td>
<td align="right">
2.00
</td>
</tr>
<tr>
<td align="right">
9
</td>
<td>
AD
</td>
<td align="right">
1998.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
1.00
</td>
</tr>
<tr>
<td align="right">
10
</td>
<td>
AD
</td>
<td align="right">
1999.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
1.00
</td>
</tr>
<tr>
<td align="right">
11
</td>
<td>
AD
</td>
<td align="right">
2000.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
0.00
</td>
<td align="right">
0.00
</td>
<td align="right">
1.00
</td>
<td align="right">
0.00
</td>
</tr>
<tr>
<td align="right">
12
</td>
<td>
AD
</td>
<td align="right">
2001.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
0.00
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
2.00
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="the-problems" class="slide level2">
<h2>The problems</h2>
<p>There are two main problems with this dataset:</p>
<ol type="1">
<li class="fragment">We have column names representing observations.</li>
<li class="fragment">There are two type of information in column names (sex and age).</li>
</ol>
</section>
<section id="problem-1" class="slide level2">
<h2>Problem #1</h2>
<h4 id="column-headers-are-values-not-variable-names-1">Column headers are values, not variable names</h4>
<p>As for the previous dataset, we use the <code>gather()</code> function.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">fixed &lt;-<span class="st"> </span><span class="kw">gather</span>(messy, demographic, frequency, <span class="op">-</span>iso2, <span class="op">-</span>year)</a></code></pre></div>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:58 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
iso2
</th>
<th>
year
</th>
<th>
demographic
</th>
<th>
frequency
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
AD
</td>
<td align="right">
1989.00
</td>
<td>
new_sp_m04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
AD
</td>
<td align="right">
1990.00
</td>
<td>
new_sp_m04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
AD
</td>
<td align="right">
1991.00
</td>
<td>
new_sp_m04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
AD
</td>
<td align="right">
1992.00
</td>
<td>
new_sp_m04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
AD
</td>
<td align="right">
1993.00
</td>
<td>
new_sp_m04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
AD
</td>
<td align="right">
1994.00
</td>
<td>
new_sp_m04
</td>
<td align="right">
NA
</td>
</tr>
</table>
<p></small></p>
<p><small> At this point, the dataset looks already better. </small></p>
</section>
<section id="problem-2" class="slide level2">
<h2>Problem #2</h2>
<h4 id="multiple-variables-stored-in-one-column-1">Multiple variables stored in one column</h4>
<p>The column demographic contains two types of information (sex and age).</p>
<center>
<figure>
<img style="margin:0px auto;display:block" src="myfigs/new_sp.svg" width = "700"/>
</figure>
</center>
<p>It seems ti be always the same pattern: sex start at the <strong>7th position</strong> and the age at the <strong>8th position</strong>.</p>
</section>
<section id="problem-2-1" class="slide level2">
<h2>Problem #2</h2>
<p>To “split” this column into three different columns, we will use the <code>separate()</code> function.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">fixed &lt;-<span class="st"> </span><span class="kw">separate</span>(<span class="dt">data =</span> fixed, <span class="co"># Which data frame we separate</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2">         <span class="dt">col =</span> demographic, <span class="co"># Which column we want to separate</span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3">         <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;junk&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age_group&quot;</span>), <span class="co"># The new col. names</span></a>
<a class="sourceLine" id="cb99-4" data-line-number="4">         <span class="dt">sep =</span> <span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>)) <span class="co"># How do we split the demographic col?</span></a></code></pre></div>
</section>
<section id="the-result" class="slide level2">
<h2>The result</h2>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:59 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
iso2
</th>
<th>
year
</th>
<th>
junk
</th>
<th>
sex
</th>
<th>
age_group
</th>
<th>
frequency
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
AD
</td>
<td align="right">
1989.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
AD
</td>
<td align="right">
1990.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
AD
</td>
<td align="right">
1991.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
AD
</td>
<td align="right">
1992.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
AD
</td>
<td align="right">
1993.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
AD
</td>
<td align="right">
1994.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
7
</td>
<td>
AD
</td>
<td align="right">
1996.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
8
</td>
<td>
AD
</td>
<td align="right">
1997.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
9
</td>
<td>
AD
</td>
<td align="right">
1998.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
10
</td>
<td>
AD
</td>
<td align="right">
1999.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
11
</td>
<td>
AD
</td>
<td align="right">
2000.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
12
</td>
<td>
AD
</td>
<td align="right">
2001.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
13
</td>
<td>
AD
</td>
<td align="right">
2002.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
14
</td>
<td>
AD
</td>
<td align="right">
2003.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
15
</td>
<td>
AD
</td>
<td align="right">
2004.00
</td>
<td>
new_sp_
</td>
<td>
m
</td>
<td>
04
</td>
<td align="right">
NA
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="variables-are-stored-in-both-rows-and-columns" class="slide level2">
<h2>Variables are stored in both rows and columns</h2>
</section>
<section id="the-messy-data-4" class="slide level2">
<h2>The messy data</h2>
<p>The following messy dataset is the daily weather data from the Global Historical Climatology Network for one weather station (MX17004) in Mexico for five months in 2010.</p>
<p>Take a minute to look at the following table to find what are the main problems.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1">messy &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;https://goo.gl/eUUJ6n&quot;</span>)</a></code></pre></div>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:59 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
id
</th>
<th>
year
</th>
<th>
month
</th>
<th>
element
</th>
<th>
d1
</th>
<th>
d2
</th>
<th>
d3
</th>
<th>
d4
</th>
<th>
d5
</th>
<th>
d6
</th>
<th>
d7
</th>
<th>
d8
</th>
<th>
d9
</th>
<th>
d10
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
1.00
</td>
<td>
tmax
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td>
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
1.00
</td>
<td>
tmin
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td>
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmax
</td>
<td align="right">
NA
</td>
<td align="right">
27.30
</td>
<td align="right">
24.10
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td>
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmin
</td>
<td align="right">
NA
</td>
<td align="right">
14.40
</td>
<td align="right">
14.40
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td>
NA
</td>
<td align="right">
NA
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
3.00
</td>
<td>
tmax
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
32.10
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td>
NA
</td>
<td align="right">
34.50
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
3.00
</td>
<td>
tmin
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
14.20
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td align="right">
NA
</td>
<td>
NA
</td>
<td align="right">
16.80
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="problem-1-1" class="slide level2">
<h2>Problem #1</h2>
<h4 id="column-headers-are-values-not-variable-names-2">Column headers are values, not variable names</h4>
<p>It is easy to understand that we have values spread in the columns. For instance, <code>d1</code> means <strong>day 1</strong>. We should instead have a column named <code>day</code> with values from 1 to 31.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">fixed &lt;-<span class="st"> </span><span class="kw">gather</span>(messy, day, temperature, <span class="op">-</span>id, <span class="op">-</span>year, <span class="op">-</span>month, <span class="op">-</span>element)</a>
<a class="sourceLine" id="cb101-2" data-line-number="2"></a>
<a class="sourceLine" id="cb101-3" data-line-number="3">fixed &lt;-<span class="st"> </span><span class="kw">na.omit</span>(fixed) <span class="co"># Remove NA while we there</span></a></code></pre></div>
</section>
<section id="first-problem-resolved" class="slide level2">
<h2>First problem resolved</h2>
<p>It feels better already.</p>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:59 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
id
</th>
<th>
year
</th>
<th>
month
</th>
<th>
element
</th>
<th>
day
</th>
<th>
temperature
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
12.00
</td>
<td>
tmax
</td>
<td>
d1
</td>
<td align="right">
29.90
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
12.00
</td>
<td>
tmin
</td>
<td>
d1
</td>
<td align="right">
13.80
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmax
</td>
<td>
d2
</td>
<td align="right">
27.30
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmin
</td>
<td>
d2
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmax
</td>
<td>
d2
</td>
<td align="right">
31.30
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmin
</td>
<td>
d2
</td>
<td align="right">
16.30
</td>
</tr>
<tr>
<td align="right">
7
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmax
</td>
<td>
d3
</td>
<td align="right">
24.10
</td>
</tr>
<tr>
<td align="right">
8
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmin
</td>
<td>
d3
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
9
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
7.00
</td>
<td>
tmax
</td>
<td>
d3
</td>
<td align="right">
28.60
</td>
</tr>
<tr>
<td align="right">
10
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
7.00
</td>
<td>
tmin
</td>
<td>
d3
</td>
<td align="right">
17.50
</td>
</tr>
<tr>
<td align="right">
11
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmax
</td>
<td>
d4
</td>
<td align="right">
27.20
</td>
</tr>
<tr>
<td align="right">
12
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmin
</td>
<td>
d4
</td>
<td align="right">
12.00
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="problem-2-2" class="slide level2">
<h2>Problem #2</h2>
<h4 id="the-variable-day-is-not-numeric.">The variable <code>day</code> is not numeric.</h4>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw">str</span>(fixed)</a></code></pre></div>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    66 obs. of  6 variables:
##  $ id         : chr  &quot;MX17004&quot; &quot;MX17004&quot; &quot;MX17004&quot; &quot;MX17004&quot; ...
##  $ year       : num  2010 2010 2010 2010 2010 2010 2010 2010 2010 2010 ...
##  $ month      : num  12 12 2 2 11 11 2 2 7 7 ...
##  $ element    : chr  &quot;tmax&quot; &quot;tmin&quot; &quot;tmax&quot; &quot;tmin&quot; ...
##  $ day        : chr  &quot;d1&quot; &quot;d1&quot; &quot;d2&quot; &quot;d2&quot; ...
##  $ temperature: num  29.9 13.8 27.3 14.4 31.3 16.3 24.1 14.4 28.6 17.5 ...
##  - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int  1 2 3 4 5 6 7 8 9 10 ...
##   ..- attr(*, &quot;names&quot;)= chr  &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...</code></pre>
</section>
<section id="problem-2-3" class="slide level2">
<h2>Problem #2</h2>
<p>We can easily extract numerical values from character using the <code>parse_number()</code> function.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">fixed &lt;-<span class="st"> </span><span class="kw">mutate</span>(fixed, <span class="dt">day =</span> <span class="kw">parse_number</span>(day))</a></code></pre></div>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:59 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
id
</th>
<th>
year
</th>
<th>
month
</th>
<th>
element
</th>
<th>
day
</th>
<th>
temperature
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
12.00
</td>
<td>
tmax
</td>
<td align="right">
1.00
</td>
<td align="right">
29.90
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
12.00
</td>
<td>
tmin
</td>
<td align="right">
1.00
</td>
<td align="right">
13.80
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmax
</td>
<td align="right">
2.00
</td>
<td align="right">
27.30
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmin
</td>
<td align="right">
2.00
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmax
</td>
<td align="right">
2.00
</td>
<td align="right">
31.30
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmin
</td>
<td align="right">
2.00
</td>
<td align="right">
16.30
</td>
</tr>
<tr>
<td align="right">
7
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmax
</td>
<td align="right">
3.00
</td>
<td align="right">
24.10
</td>
</tr>
<tr>
<td align="right">
8
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmin
</td>
<td align="right">
3.00
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
9
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
7.00
</td>
<td>
tmax
</td>
<td align="right">
3.00
</td>
<td align="right">
28.60
</td>
</tr>
<tr>
<td align="right">
10
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
7.00
</td>
<td>
tmin
</td>
<td align="right">
3.00
</td>
<td align="right">
17.50
</td>
</tr>
<tr>
<td align="right">
11
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmax
</td>
<td align="right">
4.00
</td>
<td align="right">
27.20
</td>
</tr>
<tr>
<td align="right">
12
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmin
</td>
<td align="right">
4.00
</td>
<td align="right">
12.00
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="problem-3" class="slide level2">
<h2>Problem #3</h2>
<h4 id="variables-are-stored-in-column">Variables are stored in column</h4>
<p>Looking at the table we see that there is something strange with <code>element</code>. Can you guess it?</p>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:59 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
id
</th>
<th>
year
</th>
<th>
month
</th>
<th>
element
</th>
<th>
day
</th>
<th>
temperature
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
12.00
</td>
<td>
tmax
</td>
<td align="right">
1.00
</td>
<td align="right">
29.90
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
12.00
</td>
<td>
tmin
</td>
<td align="right">
1.00
</td>
<td align="right">
13.80
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmax
</td>
<td align="right">
2.00
</td>
<td align="right">
27.30
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmin
</td>
<td align="right">
2.00
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmax
</td>
<td align="right">
2.00
</td>
<td align="right">
31.30
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmin
</td>
<td align="right">
2.00
</td>
<td align="right">
16.30
</td>
</tr>
<tr>
<td align="right">
7
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmax
</td>
<td align="right">
3.00
</td>
<td align="right">
24.10
</td>
</tr>
<tr>
<td align="right">
8
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td>
tmin
</td>
<td align="right">
3.00
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
9
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
7.00
</td>
<td>
tmax
</td>
<td align="right">
3.00
</td>
<td align="right">
28.60
</td>
</tr>
<tr>
<td align="right">
10
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
7.00
</td>
<td>
tmin
</td>
<td align="right">
3.00
</td>
<td align="right">
17.50
</td>
</tr>
<tr>
<td align="right">
11
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmax
</td>
<td align="right">
4.00
</td>
<td align="right">
27.20
</td>
</tr>
<tr>
<td align="right">
12
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
11.00
</td>
<td>
tmin
</td>
<td align="right">
4.00
</td>
<td align="right">
12.00
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="problem-3-1" class="slide level2">
<h2>Problem #3</h2>
<p><code>tmin</code> and <code>tmax</code> are variables, not values and we should make them columns instead.</p>
<p>This is easily done using the <code>spread()</code> function.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">fixed &lt;-<span class="st"> </span><span class="kw">spread</span>(fixed, element, temperature)</a></code></pre></div>
<small> <!-- html table generated in R 3.5.2 by xtable 1.8-2 package --> <!-- Mon Mar  4 15:21:59 2019 -->
<table border="1">
<tr>
<th>
</th>
<th>
id
</th>
<th>
year
</th>
<th>
month
</th>
<th>
day
</th>
<th>
tmax
</th>
<th>
tmin
</th>
</tr>
<tr>
<td align="right">
1
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
1.00
</td>
<td align="right">
30.00
</td>
<td align="right">
27.80
</td>
<td align="right">
14.50
</td>
</tr>
<tr>
<td align="right">
2
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td align="right">
2.00
</td>
<td align="right">
27.30
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
3
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td align="right">
3.00
</td>
<td align="right">
24.10
</td>
<td align="right">
14.40
</td>
</tr>
<tr>
<td align="right">
4
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td align="right">
11.00
</td>
<td align="right">
29.70
</td>
<td align="right">
13.40
</td>
</tr>
<tr>
<td align="right">
5
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
2.00
</td>
<td align="right">
23.00
</td>
<td align="right">
29.90
</td>
<td align="right">
10.70
</td>
</tr>
<tr>
<td align="right">
6
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
3.00
</td>
<td align="right">
5.00
</td>
<td align="right">
32.10
</td>
<td align="right">
14.20
</td>
</tr>
<tr>
<td align="right">
7
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
3.00
</td>
<td align="right">
10.00
</td>
<td align="right">
34.50
</td>
<td align="right">
16.80
</td>
</tr>
<tr>
<td align="right">
8
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
3.00
</td>
<td align="right">
16.00
</td>
<td align="right">
31.10
</td>
<td align="right">
17.60
</td>
</tr>
<tr>
<td align="right">
9
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
4.00
</td>
<td align="right">
27.00
</td>
<td align="right">
36.30
</td>
<td align="right">
16.70
</td>
</tr>
<tr>
<td align="right">
10
</td>
<td>
MX17004
</td>
<td align="right">
2010.00
</td>
<td align="right">
5.00
</td>
<td align="right">
27.00
</td>
<td align="right">
33.20
</td>
<td align="right">
18.20
</td>
</tr>
</table>
<p></small></p>
</section>
<section id="your-turn" class="slide level2">
<h2>Your turn</h2>
<p>Using your data:</p>
<ul>
<li>Is you data tidy?</li>
<li>If not, what can you do?</li>
<li>Do you need to merge different data sources? What type of joins would you use?</li>
</ul>
</section>
    </div>
  </div>

  <script src="03_introduction_data_manipulation_files/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="03_introduction_data_manipulation_files/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: true,
        // Transition style
        transition: 'convex', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom



        // Optional reveal.js plugins
        dependencies: [
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
